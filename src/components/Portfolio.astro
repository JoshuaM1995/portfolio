---
import "../styles/portfolio.scss";
import Modal from "./Modal.astro";
import PortfolioCard from "./PortfolioCard.astro";
import TitleUnderlined from "./TitleUnderlined.astro";
import { Image } from "astro:assets";
---

<section id="portfolio">
  <TitleUnderlined>Portfolio</TitleUnderlined>

  <div id="portfolio-cards">
    <!-- <PortfolioCard
      id="portfolio-card-healthcare"
      backgroundImage="https://placekitten.com/g/500/300"
    >
      Healthcare Web/Mobile Application
    </PortfolioCard>
    <PortfolioCard
      id="portfolio-card-oil-gas"
      backgroundImage="https://placekitten.com/g/500/300"
    >
      Oil & Gas Web Application
    </PortfolioCard> -->
    <PortfolioCard
      id="portfolio-card-spotalytics"
      backgroundImage="/images/projects/spotalytics.png"
    >
      Spotalytics
    </PortfolioCard>
  </div>
</section>

<Modal id="spotalytics">
  <Image
    src="/images/projects/spotalytics.png"
    alt="A bird."
    width="500"
    height="1000"
  />
  <h2>Spotalytics</h2>
  <p>
    Using React and Spotify's API, I created a web application that allows users
    to view their top artists and tracks, as well as their recently played
    songs. I also integrated Spotify's recommendation engine to allow users to
    generate a playlist based on their preferences, as well as find similar
    music to their favorite artists or albums.
  </p>
</Modal>

<script>
  import MicroModal from "micromodal";

  const spotalyticsPortfolioCard = document.getElementById(
    "portfolio-card-spotalytics"
  );

  const toggleModal = (elementId: string) => {
    const htmlElement = document.getElementsByTagName("html")[0];
    const modalElement = document.getElementById(`modal-${elementId}`);
    const isOpen = modalElement.classList.contains("is-open");

    if (isOpen) {
      htmlElement.style.overflow = "auto";
      MicroModal.close(`modal-${elementId}`);
    } else {
      htmlElement.style.overflow = "hidden";
      MicroModal.show(`modal-${elementId}`);
    }
  };

  spotalyticsPortfolioCard.addEventListener("click", () => {
    toggleModal("spotalytics");
  });
</script>

<script>
  import anime from "animejs";

  let hasScrolledToPortfolio = false;

  function isElementVisible(element: HTMLElement) {
    var rect = element.getBoundingClientRect();

    return (
      rect.top >= 0 &&
      rect.left >= 0 &&
      rect.bottom <=
        (window.innerHeight || document.documentElement.clientHeight) &&
      rect.right <= (window.innerWidth || document.documentElement.clientWidth)
    );
  }

  window.addEventListener("load", () => {
    if (isElementVisible(document.getElementById("portfolio"))) {
      if (!hasScrolledToPortfolio) {
        animatePortfolioSection();
      }

      hasScrolledToPortfolio = true;

      document.getElementById("portfolio").classList.add("scrolled");
    }
  });

  window.addEventListener("scroll", () => {
    if (isElementVisible(document.getElementById("portfolio"))) {
      if (!hasScrolledToPortfolio) {
        animatePortfolioSection();
      }

      hasScrolledToPortfolio = true;

      document.getElementById("portfolio").classList.add("scrolled");
    }
  });

  const animatePortfolioSection = () => {
    anime({
      targets: "#portfolio .title-underlined",
      opacity: [0, 1],
      translateY: [-100, 0],
      duration: 500,
      easing: "linear",
    });

    anime({
      targets: "#portfolio #portfolio-cards",
      opacity: [0, 1],
      duration: 500,
      easing: "linear",
    });

    const portfolioCardElements = document.querySelectorAll(
      "#portfolio .card-image-box"
    );

    portfolioCardElements.forEach((element, index) => {
      anime({
        targets: element,
        opacity: [0, 1],
        translateX: [-50, 0],
        duration: 400,
        easing: "linear",
        delay: 600 + index * 400,
      });
    });
  };
</script>
